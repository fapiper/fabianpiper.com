workflows:
  apply:
    description: "Bootstrap of the OCI and K3s stack (includes ArgoCD)"
    steps:
      - command: terraform apply networking
      - command: terraform apply iam
      - command: terraform apply vault
      - command: terraform apply oidc
      - command: terraform apply k3s-cluster
  plan:
    description: "Dry-run of all infrastructure components"
    steps:
      - command: terraform plan networking
      - command: terraform plan iam
      - command: terraform plan vault
      - command: terraform plan oidc
      - command: terraform plan k3s-cluster
  destroy:
    description: "Teardown of all resources"
    steps:
      - command: terraform destroy k3s-cluster
      - command: terraform destroy oidc
      - command: terraform destroy vault
      - command: terraform destroy iam
      - command: terraform destroy networking
  validate:
    description: "Linter and syntax check"
    steps:
      - command: terraform validate networking
      - command: terraform validate iam
      - command: terraform validate vault
      - command: terraform validate oidc
      - command: terraform validate k3s-cluster